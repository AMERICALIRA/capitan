<% content_for :scripts do %>
  <script type="text/javascript">
    $(document).ready(function () {
      $(".lesson-checkbox input[type=checkbox]").change(function(e) {
        var id = $(e.target).val();
        $(".lesson-"+id+"-pages input[type=checkbox]").prop('checked', this.checked);
      });

      $(".check_boxes input[type=checkbox]").change(function(e) {

        var lesson_checkbox = $("input[data-lesson=checkbox-]")
      });
    });
  </script>
<% end %>
<%= simple_form_for(@sprint) do |f| %>
  <%= f.error_notification %>
  <% if @sprint.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@sprint.errors.count, "error") %> prohibited this sprint from being saved:</h2>
      <ul>
      <% @sprint.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>  

  <div class="form-inputs" style="margin-bottom:20px">
    <fieldset>
      <legend>Información general</legend>
      <%= f.input :name, placeholder: "Ingresa el nombre del sprint", label: false %>
      <%= f.input :description, placeholder: "Ingresa la descripción", label: false %>
      <%= f.association :group, collection: Branch.all, as: :grouped_select,
            group_method: :groups, label: false, :include_blank => "Seleccione un grupo" %>      
    </fieldset><br>
    <fieldset class="lessons-panel">
      <legend>Lecciones asociadas</legend>
      <% @lessons.each do |lesson| %>
        <span class="checkbox lesson-checkbox">
          <label for="lesson-<%= lesson.id%>-checkbox">
            <input type="checkbox" name="lesson" value="<%= lesson.id %>" class="check_boxes optional" data-lesson="checkbox-<% lesson.id %>"/>
            <%= lesson.title %>  
          </label>
        </span>
        <div style="margin-left: 30px;" class="lesson-<%= lesson.id %>-pages">
          <%= f.association :pages,
                            collection: lesson.pages,
                            as: :check_boxes, 
                            label: false,
                            checked: @sprint.page_ids,
                            input_html: { "lesson-id" => lesson.id} %>          
        </div>
      <% end %>

    </fieldset><br>
    <fieldset>
      <legend>Badges para este sprint</legend>
      <%= f.association :badges, 
                        as: :check_boxes, 
                        label: false,
                        label_method: :name,
                        value_method: :id,
                        checked: @sprint.badge_ids %>
    </fieldset>
  </div>
  <div class="form-actions">
    <%= f.button :submit,"Crear sprint", class: 'btn btn-primary' %>
    <%= link_to 'Cancelar', sprints_path, class: 'btn btn-danger' %>
  </div>
<% end %>